{% extends "base.html" %}
{% block title %}Petani Pintar{% endblock %}
{% block content %}
<div class="glass p-8 rounded-2xl shadow-xl">
  <h2 class="text-3xl font-bold text-green-400 mb-6">ðŸ¤– ChatBot Petani Rawa</h2>
  
  <form method="post" class="space-y-4">
    <input
      type="text"
      name="question"
      placeholder="Tanyakan tentang pertanian rawa..."
      class="w-full p-3 rounded-lg bg-green-900/30 border border-green-500 text-white placeholder-green-300 focus:outline-none focus:ring focus:ring-green-400"
      required
    />
    <button
      type="submit"
      class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold transition"
    >
      Kirim Pertanyaan
    </button>
  </form>

   <!-- Loading -->
  <div id="loading" class="mt-6 hidden text-green-300 italic">ðŸ’­ Sedang berpikir...</div>

  {% if response %}
  <div class="mt-6 p-4 bg-green-800/30 border border-green-500 rounded-xl text-green-100">
    <h3 class="font-bold mb-2">ðŸ’¡ Jawaban AI:</h3>
    <p id="typingText" data-response={{ response | tojson }}></p>
  </div>
  {% endif %}

  <div class="mt-10 text-center">
    <a href="/" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full transition">
      â¬… Kembali ke Beranda
    </a>
  </div>
</div>

<script>
// Saat submit form, tampilkan loading
document.getElementById("chatForm").addEventListener("submit", function() {
  document.getElementById("loading").classList.remove("hidden");
});

// Efek mengetik untuk jawaban
let typingElement = document.getElementById("typingText");
if (typingElement) {
  let text = typingElement.dataset.response || "";
  let index = 0;

  function typeEffect() {
    if (index < text.length) {
      typingElement.innerHTML += text.charAt(index);
      index++;
      setTimeout(typeEffect, 30); // kecepatan ketik
    }
  }

  if (text.trim() !== "") {
    typeEffect();
  }
}
</script>
{% endblock %}
